<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perceptron Visual Lab</title>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <div id="app">
      <header class="hero">
        <div>
          <p class="eyebrow">Perceptron Visual Lab</p>
          <h1>Make the decision boundary move.</h1>
          <p class="subhead">A hands-on view of weights, mistakes, and linearly separable data.</p>
        </div>
        <div class="controls">
          <label>
            <span>Dataset</span>
            <select id="dataset">
              <option value="or">OR</option>
              <option value="xor">XOR</option>
            </select>
          </label>
          <div class="static-field">
            <span>Switchboard</span>
            <strong>1×2 (two inputs)</strong>
          </div>
          <button id="step">Step</button>
          <button id="reset">Reset</button>
          <label>
            <span>Learning rate</span>
            <div class="lr-row">
              <input id="lr" type="range" min="0.1" max="2" step="0.1" value="1" />
              <span id="lr-value">1.0</span>
            </div>
          </label>
          <label>
            <span>API base</span>
            <input id="api-base" type="text" value="http://127.0.0.1:8000" />
          </label>
          <p class="hotkeys">Shortcuts: <strong>S</strong> step, <strong>R</strong> reset</p>
        </div>
      </header>

      <main class="grid">
        <section class="panel">
          <h2>2D Boundary</h2>
          <canvas id="plot" class="plot-canvas" width="420" height="420"></canvas>
        </section>

        <section class="panel">
          <h2>Switchboard</h2>
          <div class="switchboard">
            <div class="switch-row">
              <div>
                <h3>Input</h3>
                <canvas id="input" width="200" height="120"></canvas>
              </div>
              <div>
                <h3>Weights (before)</h3>
                <canvas id="weights-before" width="200" height="120"></canvas>
              </div>
            </div>
            <div class="switch-row">
              <div>
                <h3>Contribution (pre-update)</h3>
                <canvas id="contrib" width="200" height="120"></canvas>
              </div>
              <div class="bias-card">
                <h3>Bias (before)</h3>
                <div class="bias-value" id="bias-before">0.00</div>
                <div class="bias-note">Adds to score</div>
              </div>
            </div>
          </div>
          <div id="cell-tooltip" class="cell-tooltip is-hidden"></div>
          <div class="meter">
            <span>Score (s)</span>
            <strong id="score">0.00</strong>
          </div>
        </section>

        <section class="panel">
          <h2>After update</h2>
          <div class="switchboard">
            <div class="switch-row">
              <div>
                <h3>Weights (after)</h3>
                <canvas id="weights-after" width="200" height="120"></canvas>
              </div>
              <div class="bias-card bias-after">
                <h3>Bias (after)</h3>
                <div class="bias-value" id="bias-after">0.00</div>
                <div class="bias-note">After update</div>
              </div>
            </div>
          </div>
        </section>

        <section class="panel calc-panel">
          <h2>Step math</h2>
          <div class="calc-section">
            <h3>Current state</h3>
            <div class="calc-grid">
              <div><span>Weights w</span><strong id="state-w">[0.00, 0.00]</strong></div>
              <div><span>Bias b</span><strong id="state-b">0.00</strong></div>
              <div><span>Dataset</span><strong id="state-ds">or</strong></div>
              <div><span>Sample idx</span><strong id="state-idx">0</strong></div>
            </div>
          </div>
          <div class="calc-section">
            <h3>Next input (what we expect)</h3>
            <div class="calc-grid">
              <div><span>Input x</span><strong id="next-x">[-1, -1]</strong></div>
              <div><span>Label y</span><strong id="next-y">-1</strong></div>
            </div>
          </div>
          <div class="calc-section" id="last-step-section">
            <h3>Last step calculation</h3>
            <div class="calc-grid">
              <div><span>Input x</span><strong id="calc-x">[-1, 1]</strong></div>
              <div><span>Label y</span><strong id="calc-y">+1</strong></div>
              <div><span>Weights (after)</span><strong id="calc-w">[0.00, 0.00]</strong></div>
              <div><span>Bias (after)</span><strong id="calc-b">0.00</strong></div>
              <div><span>Score s</span><strong id="calc-s">0.00</strong></div>
              <div><span>Prediction ŷ</span><strong id="calc-pred">+1</strong></div>
            </div>
            <p id="calc-score-eq" class="calc-eq">s = w1·x1 + w2·x2 + b</p>
            <p id="calc-update-eq" class="calc-eq">w &larr; w + &eta; y x, b &larr; b + &eta; y</p>
            <p id="calc-note" class="calc-note">No update yet.</p>
          </div>
        </section>

        <section class="panel explain">
          <h2>What happens on each step</h2>
          <div class="math">
            <p><strong>Score:</strong> <span>s = w · x + b</span></p>
            <p><strong>Prediction:</strong> <span>ŷ = sign(s)</span></p>
            <p><strong>Mistake?</strong> <span>y · s ≤ 0</span></p>
            <p><strong>Update (only if mistake):</strong> <span>w &larr; w + &eta; y x, b &larr; b + &eta; y</span></p>
          </div>
          <p class="detail">
            The input grid shows the switches (x). The weight grid shows the dials (w). The contribution grid
            shows each cell’s product xᵢ·wᵢ before the sum. The score meter is the sum of all contributions plus bias.
          </p>
          <p class="detail">
            For XOR, no single line separates the classes, so the boundary keeps moving without converging.
          </p>
        </section>
      </main>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
